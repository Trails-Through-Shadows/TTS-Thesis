\chapter{Návrh}\label{chap:design}
Tato kapitola se bude zabývat návrhem sestavy technologií, které se budou využívat pro realizaci \gls{api}.

\section{Model vývoje}\label{sec:development_model}
Jako model vývoje byl použit klasický vodopádový model \figureref{fig:waterfall}, který sice v praxi není úplně realistický, ale je dobrým základem pro popis vývojového procesu modelové hry. Používá se primárně v situacích, kdy je definice projektu jasná a je zřejmý i cíl, kdy je dost času pro vývoj a kdy je možné všechny fáze vývoje pečlivě naplánovat, aby se minimalizovaly chyby.

První vlastností tohoto modelu je \textbf{sekvenční přístup}, neboť nemožnost pracovat na další části vývoje, dokud přechozí není plně dokončena. Další z vlastností je \textbf{řízení dokumentací}, kdy se všechny fáze vývoje musí pečlivě dokumentovat, aby se minimalizoval čas strávený zpětnou analýzou provedených kroků. \textbf{Kontrola kvality} je při tomto modelu důležitá, neboť chyby, které by se mohly vyskytnout v prvotních fázích vývoje, se mohou nepříjemně projevit a vývoj zkomplikovat. S tím se pojí i \textbf{přísné plánování}, kdy je nutné všechny fáze vývoje pečlivě naplánovat a zvážit možná rizika, která by mohla vzniknout.

Tímto modelem jsme se snažili řídit, ale i přes důkladné promyšlení použitých návrhů se muselo v průběhu pár drobností upravovat. 

\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/impl/API Implementation - waterfall model.pdf}
    \caption{Vodopádový model vývoje}\label{fig:waterfall}
\end{figure}

Ve fázi \textbf{požadavků} byly vzneseny nápady, jak samotná hra bude fungovat, jaké mechaniky použijeme a jakým způsobem by je bylo možné implementovat, přičemž nám vystačil pouze dokument s nápady a požadavky. Taktéž si zde všichni ujasnili, jaké herní mechaniky budou použity a za jakých okolností. 

Ve druhé fázi \textbf{návrhu} probíhala tvorba upřesňujících diagramů, návrhu architektury a uživatelského rozhraní. V našem případě byly přesněji rozvrženy jednotlivé mechaniky a bylo blíže popsáno, co se od nich očekává. Zároveň byly aplikovány návrhové vzory, které byly vhodné pro daný problém, především ty týkající se RESTful API.

Fáze \textbf{vývoje} zahrnuje implementaci návrhů a vytvoření funkčního programu. V této fázi se taktéž využívají unit testy, které ověřují funkčnost jednotlivých částí programu. 

Poslední fáze, \textbf{testování} a \textbf{údržba}, se starají o to, aby program byl bez chyb a aby jednotlivé programy fungovaly jako celek. Po tom, co byl projekt otestován a vše je funkční, jde do produkčního prostředí a už se pouze udržuje, což zahrnuje opravování drobných chyb, které nebyly odhaleny během testování.

\section{Spolupráce}\label{sec:collaboration}
Jak už několikrát bylo naznačeno, tato práce byla vytvářena v týmu, kde měl každý člen na starosti jinou hlavní komponentu.
\begin{itemize}[itemsep=0pt,parsep=0pt]
    \item \textbf{Herní systém} -- Barbora Kovalská
    \item \textbf{Backoffice} -- Pavel Mikula
    \item \textbf{Frontend} -- Miroslav Osoba
    \item \textbf{API} -- Martin Korotwitschka
\end{itemize}

V průběhu bylo třeba přidat i jiné komponenty, protože bez nich by nebylo zprovoznění hry jakožto celku možné, takže zvlášť na nich pracovalo více členů týmu. V raných fázích vývoje bylo taktéž běžné, že se jednotliví členové více podíleli i na ostatních úkonech. 

Komunikace v prvotních fázích vývoje probíhala především za pomocí nástroje Github Issues. Později, když už byla kostra projektu funkční, stačila interní komunikace.

\subsection{Rozdělení práce}\label{sec:collaboration:job_distribution}
Jak lze vidět na Obrázku \ref{fig:job_distribution}, každý člen týmu nesl zodpovědnost za svou část projektu. Toto rozdělení vycházelo především ze zadání prací. 

\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{../../shared/diagrams/blocks.pdf}
    \caption{Rozložení práce v týmu}
    \label{fig:job_distribution}
\end{figure}

Pro přehlednost a verzování kódu byla vytvořena organizace na platformě GitHub \figureref{fig:gitOrg}, kde se vytvořily samostatné repozitáře pro každou část projektu. Taktéž se zde vedly \textit{Issues}, které zvlášť v prvotních fázích ulehčovaly vývoj a komunikaci.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{../../shared/figures/gitOrg.png}
    \caption{Organizace \textit{Trails Through Shadows} na platformě GitHub}
    \label{fig:gitOrg}
\end{figure}

% TODO BARCE START HERE

Verzovací systém byl zvlášť potřeba v případě API, na kterém pracovali primárně dva členové týmu. Tím pádem bylo využíváno tzv. větví pro iimplementování rozličných funkcionalit. Ovšem když ještě nebyla kostra API tak takovéto rozdělování na větve není tak účinné a často se museli řešit konflikty. 

Poté co byla vytvořena kostra API se začali řádně využívat větvě a jejich pravidla. Jako hlavní větev byla zvolena \textit{master} na které byla vždy poslední stabilní verze, která byla taktéž nasazena na server. Další větev byla \textit{development} na které byly většinou funkční ale neotestované funkcionality. Ostatní větve se už v pozdější fázi vývoje nevyužívaly protože každý v API měl kompletně jinou část tím pádem jich nebylo třeba.
Výše popsané strategii dělání větví a následné jejich sloučení se říká \textit{Gitflow}.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{figures/impl/git-flow.png}
    \caption{příklad Gitflow workflow}
    \label{fig:gitflow}
\end{figure}



Ovšem například u repozitáře TTS-Thesis kde byly všechny naše práce jsme používali Trunk-Based Vývoj, neboli všechny akce se prováděli na hlavní větvi. Tento styl fungoval hlavně díky tomu že každý měl svou vlastní složku a není zde kód který by měl fungovat. Díky tomu jsme mohli mít instatntní nasazení vytvořeného PDF z \LaTeX ~souborů.

\section{Databáze}\label{sec:database}
Návrh probíhal jako první od vytvoření návrhu databáze. Na návrhu se podíleli všichni členové týmu \figureref{fig:job_distribution} jelikož bylo nutné aby všichni členové věděli co a jak bude v databázi strukturované. Návrh probíhal za pomocí placeného nástroje \textit{dbdiagram.io} kde se mohli všichni podílet i online na návrhu v jeden časový moment. Tento nástroj taktéž podporuje export do řady SQL dialektů, mimo jiné i do MySQL který jsme použili protože databáze MariaDB má stejnou syntaxi jako MySQL \sectionref{sec:data_storage}. 

V kompletním ER diagramu databáze \figureref{fig:dix:database_schema} lze vidět jednotlivé rozdělení tabulek dle barvy do jednotlivých logických celků \figureref{fig:database_schema:block}[, zjedodušené blokové schéma] . Každá tabulka má v prvním sloupci zda se jedná o klíč či ne, v druhém název atributu a v třetím jeho datový typ. Z jednotlivých řádků může být vidět závislost na ostatních tabulkách.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{../../shared/diagrams/er_macro.pdf}
    \caption{Zjednodušená databázové schéma podle logických celků}
    \label{fig:database_schema:block}
\end{figure}

Jako první je žlutá sekce která pojednává o \textbf{Akcích}. Základem je tabulka Action, která poté specifikuje o jakou akci se jedná, zda o \textit{útok, pohyb, dovednost, obnovení karet} nebo o \textit{přivolání poskoka}. Akce samozřejmě může mít i více specifikací o jakou kartu se jedná, poté skoro každý typ akce může mít nějaký přídavný efekt.

Šedá sekce \textbf{Efekt} přidává spoustu modifikací ať už jakékoli postavě jako například rezistenci na otrávení, nebo přidá modifikaci k útoku jako třeba \textit{krvácení}.

Zelená sekce se stará o \textbf{Postavu hráče}. Jako hlavní tabulka je zde \textit{Character} která má vazbu na definici o jakou postavu se bude jednat neboli tabulky \textit{Třída} a \textit{Rasa} a podle nich dostane své \textit{Akce}. Hráč má i inventář ve kterém může mít jednotlivé předměty které mu přidávají ať už statické bonusy tak jednorázové v boji.

Béžová sekce \textbf{Předmět} má na starosti \textit{předměty} a v jakých obchodech se nacházejí. Předměty jak již bylo zmíněno výše přidávají hráči bonusy.

\textbf{Protivník a Překážka} jsou v řervené sekci a specifikují protivníka nebo překážku v lokaci, ve které se bude bojovat. Jsou spojeny stejnou barvou protože tyto dvě entity jsou si velice podobné, jen jedna je statická a druhá dynamická.

Sekce \textbf{Lokace}, která je oranžová, specifikuje lokaci na které bude probíhat bojová interakce. Základem je tabulka \textit{Location} která má relace na vstupní a výstupní hexagony, na protivníky a překážky , dveře a na části lokace ze kterých se tato lokace skládá. 

A jako poslední sekce \textbf{Kampaň a Dobrodružství}, ikdyž jsou každá jinou barvou (Kampaň modrá a Dobrodružství fialová) tak spolu úzce souvisí. \textit{Kampaň} má příběh k dané lokaci, seznam \textit{dobrodružství} a seznam po jakých lokacích lze jít. \textit{Dobrodružství} má seznam hráčů kteří se účastní a  seznam dostupných lokací




